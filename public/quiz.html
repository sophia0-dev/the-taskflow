<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Review</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS STYLING --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .quiz-container {
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 600px; /* Made slightly wider for the review section */
            padding: 30px;
            text-align: center;
            position: relative;
            max-height: 90vh; /* Prevent it from being too tall */
            overflow-y: auto; /* Scroll if content is too long */
        }

        .hide { display: none !important; }

        h2 { color: #333; margin-bottom: 15px; font-size: 1.6rem; }
        p { color: #666; margin-bottom: 25px; }

        /* Buttons */
        button {
            background-image: linear-gradient(to right, #667eea, #764ba2);
            color: #fff;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        button:hover { transform: translateY(-2px); }

        /* Options */
        .options-list { list-style-type: none; text-align: left; margin-bottom: 25px; }
        .options-list li { margin-bottom: 12px; }
        .options-list input[type="radio"] { display: none; }
        .options-list label {
            display: block;
            background-color: #f3f4f6;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
        }
        .options-list input[type="radio"]:checked + label {
            background-color: #f3e5f5;
            border: 1px solid #764ba2;
            color: #764ba2;
            font-weight: 600;
        }

        /* Result Circle */
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px auto;
            color: white;
        }
        .score-circle #score { font-size: 3rem; font-weight: 700; line-height: 1; }

        /* --- NEW: REVIEW SECTION STYLES --- */
        .review-container {
            text-align: left;
            margin-top: 20px;
            border-top: 2px solid #eee;
            padding-top: 20px;
        }
        
        .review-title {
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
            text-align: center;
        }

        .review-item {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #ff4444; /* Red border for wrong answers */
        }

        .review-q {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .your-ans {
            color: #e74c3c; /* Red */
            font-size: 0.9rem;
            display: block;
            margin-bottom: 4px;
        }

        .correct-ans {
            color: #27ae60; /* Green */
            font-size: 0.9rem;
            display: block;
            font-weight: 500;
        }

    </style>
</head>
<body>
    
    <div class="quiz-container">
        
        <div id="start-screen">
            <h2>Welcome to the Quiz!</h2>
            <p>Test your skills. We'll review your mistakes at the end.</p>
            <button id="start-btn">Start Quiz</button>
        </div>

        <div id="question-screen" class="hide">
            <h2 id="question-text">Question?</h2>
            <ul class="options-list">
                <li><input type="radio" name="answer" id="a" class="answer"><label for="a" id="a_text">Option A</label></li>
                <li><input type="radio" name="answer" id="b" class="answer"><label for="b" id="b_text">Option B</label></li>
                <li><input type="radio" name="answer" id="c" class="answer"><label for="c" id="c_text">Option C</label></li>
                <li><input type="radio" name="answer" id="d" class="answer"><label for="d" id="d_text">Option D</label></li>
            </ul>
            <button id="submit">Submit Answer</button>
        </div>

        <div id="result-screen" class="hide">
            <h2>Quiz Completed!</h2>
            <div class="score-circle">
                <span id="score">0</span>
                <span style="font-size: 0.9rem; opacity: 0.8;">/ 5</span>
            </div>
            <p id="feedback-text"></p>
            
            <div id="review-section" class="review-container hide">
                <div class="review-title">Review Mistakes</div>
                <div id="review-list"></div>
            </div>

            <button onclick="location.reload()">Play Again</button>
        </div>

    </div>

    <script>
        // 1. Data
        const quizData = [
            {
                question: "Which language runs in a web browser?",
                a: "Java", b: "C", c: "Python", d: "JavaScript",
                correct: "d",
                correctText: "JavaScript" // Store text for review
            },
            {
                question: "What does CSS stand for?",
                a: "Central Style Sheets", b: "Cascading Style Sheets", c: "Complex Style Sheets", d: "Cars SUVs Sailboats",
                correct: "b",
                correctText: "Cascading Style Sheets"
            },
            {
                question: "What does HTML stand for?",
                a: "Hypertext Markup Language", b: "Hypertext Markdown Language", c: "Hyperloop Machine Language", d: "None",
                correct: "a",
                correctText: "Hypertext Markup Language"
            },
            {
                question: "What year was JavaScript launched?",
                a: "1996", b: "1995", c: "1994", d: "1993",
                correct: "b",
                correctText: "1995"
            },
            {
                question: "Which tool is used to style web pages?",
                a: "HTML", b: "JQuery", c: "CSS", d: "React",
                correct: "c",
                correctText: "CSS"
            }
        ];

        // 2. Elements
        const startScreen = document.getElementById('start-screen');
        const questionScreen = document.getElementById('question-screen');
        const resultScreen = document.getElementById('result-screen');
        const questionText = document.getElementById('question-text');
        const answerEls = document.querySelectorAll('.answer');
        const a_text = document.getElementById('a_text');
        const b_text = document.getElementById('b_text');
        const c_text = document.getElementById('c_text');
        const d_text = document.getElementById('d_text');
        const submitBtn = document.getElementById('submit');
        const scoreEl = document.getElementById('score');
        const feedbackText = document.getElementById('feedback-text');
        
        // Review Elements
        const reviewSection = document.getElementById('review-section');
        const reviewList = document.getElementById('review-list');

        let currentQuiz = 0;
        let score = 0;
        let userAnswers = []; // Store user's choices here

        // 3. Start
        document.getElementById('start-btn').addEventListener('click', () => {
            startScreen.classList.add('hide');
            questionScreen.classList.remove('hide');
            loadQuiz();
        });

        function loadQuiz() {
            deselectAnswers();
            const currentQuizData = quizData[currentQuiz];
            questionText.innerText = currentQuizData.question;
            a_text.innerText = currentQuizData.a;
            b_text.innerText = currentQuizData.b;
            c_text.innerText = currentQuizData.c;
            d_text.innerText = currentQuizData.d;
        }

        function deselectAnswers() {
            answerEls.forEach(el => el.checked = false);
        }

        function getSelected() {
            let answer;
            answerEls.forEach(el => {
                if(el.checked) answer = el.id;
            });
            return answer;
        }

        // 4. Submit Logic
        submitBtn.addEventListener('click', () => {
            const answer = getSelected();
            
            if(answer) {
                // Save user answer for review
                const currentData = quizData[currentQuiz];
                
                // We need the TEXT of the answer they picked (e.g., "Python") not just "c"
                // We access the property dynamically: currentData["c"] gives "Python"
                const userAnswerText = currentData[answer]; 

                userAnswers.push({
                    question: currentData.question,
                    isCorrect: answer === currentData.correct,
                    yourAnswer: userAnswerText,
                    correctAnswer: currentData.correctText
                });

                if(answer === currentData.correct) score++;

                currentQuiz++;

                if(currentQuiz < quizData.length) {
                    loadQuiz();
                } else {
                    showResults();
                }
            } else {
                alert("Please select an answer!");
            }
        });

        // 5. Show Results & Generate Review
        function showResults() {
            questionScreen.classList.add('hide');
            resultScreen.classList.remove('hide');
            scoreEl.innerText = score;

            // Feedback Text
            if(score === quizData.length) feedbackText.innerText = "Perfect! No mistakes.";
            else if (score > 2) feedbackText.innerText = "Good job!";
            else feedbackText.innerText = "Keep practicing.";

            // --- GENERATE REVIEW LIST ---
            // Only show review if they got something wrong
            if(score < quizData.length) {
                reviewSection.classList.remove('hide');
                reviewList.innerHTML = ''; // Clear previous

                userAnswers.forEach(item => {
                    // Only show wrong answers
                    if(!item.isCorrect) {
                        const reviewItem = document.createElement('div');
                        reviewItem.classList.add('review-item');
                        reviewItem.innerHTML = `
                            <div class="review-q">${item.question}</div>
                            <span class="your-ans">❌ You selected: ${item.yourAnswer}</span>
                            <span class="correct-ans">✅ Correct answer: ${item.correctAnswer}</span>
                        `;
                        reviewList.appendChild(reviewItem);
                    }
                });
            }
            
            // SAVE TO DB (If you have the backend set up)
            const userId = localStorage.getItem('hubUserId');
            if(userId) {
                fetch('/api/quiz', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, score, total: quizData.length })
                }).catch(e => console.log(e));
            }
        }
    </script>
</body>
</html>